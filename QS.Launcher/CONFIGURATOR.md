# Configurator - Управление конфигурацией подключений

## Механизм резервного копирования

При каждом сохранении конфигурации создается резервная копия **предыдущей рабочей версии**. Backup файл постоянно хранит последнюю рабочую версию и никогда не удаляется.

### Структура файлов

- `connections.json` - основной файл конфигурации
- `connections.json.backup` - резервная копия предыдущей рабочей версии (постоянная)
- `connections.json.tmp` - временный файл (удаляется после сохранения)
- `connections.json.lock` - файл блокировки (удаляется после сохранения)

### Процесс сохранения

1. Создается файл блокировки для защиты от конкурентного доступа
2. Данные сериализуются во временный файл
3. Временный файл валидируется (проверка пустоты и корректности JSON)
4. Основной файл копируется в backup (если существует и не пуст)
5. Временный файл атомарно заменяет основной файл
6. Резервная копия остается на месте
7. Удаляются временные файлы (`.tmp` и `.lock`)

### Восстановление

Автоматическое восстановление происходит при:
- Отсутствии основного файла
- Пустом основном файле (0 байт)
- Невалидном JSON в основном файле

Резервная копия копируется на место основного файла и остается для дальнейшего использования.

## Использование

```csharp
var configurator = new Configurator(options, interactive, connectionTypes);

// Чтение с автоматическим восстановлением при необходимости
var connections = configurator.ReadConnections();

// Сохранение с созданием резервной копии
configurator.SaveConnections(connections);
```

